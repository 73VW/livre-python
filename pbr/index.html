
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="fr">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>‚öôÔ∏èAutomate your publishing to PyPI with PBR and Travis &#8212; Biblioth√®ques Python 1.0.0 documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Recherche" href="../search.html" />
    <link rel="next" title="√Ä propos de ce livre" href="../misc/about.html" />
    <link rel="prev" title="watchdog" href="../watchdog/index.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="admonition note" id="pbr-tutorial">
<p class="first admonition-title">Note</p>
<p><strong>Attention, en Anglais!</strong></p>
<p class="last">Ce tutoriel est en anglais car il provient du projet de <a class="reference external" href="https://github.com/73VW/Publishing-to-PyPI-with-pbr-and-Travis">Ma√´l Pedretti</a>, auteur du tutoriel sur <a class="reference internal" href="../secrets/index.html#secrets-tutorial"><span class="std std-ref">secrets</span></a>.</p>
</div>
<div class="section" id="automate-your-publishing-to-pypi-with-pbr-and-travis">
<h1><cite>‚öôÔ∏èAutomate your publishing to PyPI with PBR and Travis</cite><a class="headerlink" href="#automate-your-publishing-to-pypi-with-pbr-and-travis" title="Permalink to this headline">¬∂</a></h1>
<div class="section" id="step-1-write-the-setup-for-your-python-project">
<h2><cite>‚úîÔ∏èStep 1: write the setup for your python project</cite><a class="headerlink" href="#step-1-write-the-setup-for-your-python-project" title="Permalink to this headline">¬∂</a></h2>
<p>If you want to publish your project to PyPi, you first have to make a setup file.</p>
<p>In this tutorial, I will cover the use of <a class="reference external" href="https://docs.openstack.org/pbr/latest/index.html">PBR</a> which simplifies the process.</p>
<div class="section" id="setup-py">
<h3><cite>Setup.py</cite><a class="headerlink" href="#setup-py" title="Permalink to this headline">¬∂</a></h3>
<p>As you can see in the <a class="reference external" href="./setup.py">python setup</a> file included in this repository, the syntax is quite basic.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;Setup example.&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">setuptools</span> <span class="k">import</span> <span class="n">setup</span>


<span class="n">setup</span><span class="p">(</span>
    <span class="n">setup_requires</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;pbr&#39;</span><span class="p">],</span>
    <span class="n">pbr</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
<p>üéâ You simplify define that you want to use <a class="reference external" href="https://docs.openstack.org/pbr/latest/index.html">PBR</a> and that‚Äôs it! üéâ</p>
</div>
<div class="section" id="setup-cfg">
<h3><cite>Setup.cfg</cite><a class="headerlink" href="#setup-cfg" title="Permalink to this headline">¬∂</a></h3>
<p>As you can see in the <a class="reference external" href="./setup.cfg">config setup</a> file included in this repository, the syntax not more complicated than the last file.</p>
<p>Let‚Äôs go through every section together.</p>
<p>First of all, the metadata section:</p>
<div class="code yaml highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">metadata</span><span class="p">]</span>
<span class="c1"># App name</span>
<span class="n">name</span> <span class="o">=</span> <span class="n">Publishing</span> <span class="n">to</span> <span class="n">PyPI</span> <span class="k">with</span> <span class="n">pbr</span> <span class="ow">and</span> <span class="n">Travis</span>
<span class="c1"># Who made it?</span>
<span class="n">author</span> <span class="o">=</span> <span class="n">Ma√´l</span> <span class="n">Pedretti</span>
<span class="c1"># Do I really need to explain the following?</span>
<span class="n">author_email</span> <span class="o">=</span> <span class="n">mael</span><span class="o">.</span><span class="n">pedretti</span><span class="nd">@he</span><span class="o">-</span><span class="n">arc</span><span class="o">.</span><span class="n">ch</span>
<span class="c1"># The short description of your app</span>
<span class="n">summary</span> <span class="o">=</span> <span class="n">Publishing</span> <span class="n">to</span> <span class="n">Pypi</span> <span class="k">with</span> <span class="n">PBR</span> <span class="ow">and</span> <span class="n">Travis</span><span class="o">.</span>
<span class="c1"># License type</span>
<span class="n">license</span> <span class="o">=</span> <span class="n">MIT</span>
<span class="c1"># Which file contains the long description?</span>
<span class="n">description</span><span class="o">-</span><span class="n">file</span> <span class="o">=</span>
    <span class="n">README</span><span class="o">.</span><span class="n">rst</span>
<span class="c1"># Where can I access the project?</span>
<span class="n">home</span><span class="o">-</span><span class="n">page</span> <span class="o">=</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="mi">73</span><span class="n">VW</span><span class="o">/</span><span class="n">Publishing</span><span class="o">-</span><span class="n">to</span><span class="o">-</span><span class="n">PyPI</span><span class="o">-</span><span class="k">with</span><span class="o">-</span><span class="n">pbr</span><span class="o">-</span><span class="ow">and</span><span class="o">-</span><span class="n">Travis</span>
<span class="c1"># Which version of Python does it need to run?</span>
<span class="n">python_requires</span> <span class="o">=</span> <span class="o">&gt;=</span><span class="mf">3.6</span>
<span class="c1"># How do you classify your app? https://pypi.python.org/pypi?%3Aaction=list_classifiers</span>
<span class="n">classifier</span> <span class="o">=</span>
    <span class="n">Development</span> <span class="n">Status</span> <span class="p">::</span> <span class="mi">4</span> <span class="o">-</span> <span class="n">Beta</span>
    <span class="n">Environment</span> <span class="p">::</span> <span class="n">Other</span> <span class="n">Environment</span>
    <span class="n">Intended</span> <span class="n">Audience</span> <span class="p">::</span> <span class="n">Education</span>
    <span class="n">Operating</span> <span class="n">System</span> <span class="p">::</span> <span class="n">MacOS</span> <span class="p">::</span> <span class="n">MacOS</span> <span class="n">X</span>
    <span class="n">Operating</span> <span class="n">System</span> <span class="p">::</span> <span class="n">Microsoft</span> <span class="p">::</span> <span class="n">Windows</span>
    <span class="n">Operating</span> <span class="n">System</span> <span class="p">::</span> <span class="n">POSIX</span>
    <span class="n">Programming</span> <span class="n">Language</span> <span class="p">::</span> <span class="n">Python</span> <span class="p">::</span> <span class="mi">3</span> <span class="p">::</span> <span class="n">Only</span>
    <span class="n">Programming</span> <span class="n">Language</span> <span class="p">::</span> <span class="n">Python</span> <span class="p">::</span> <span class="mf">3.6</span>
    <span class="n">Programming</span> <span class="n">Language</span> <span class="p">::</span> <span class="n">Python</span> <span class="p">::</span> <span class="n">Implementation</span> <span class="p">::</span> <span class="n">CPython</span>
    <span class="n">Topic</span> <span class="p">::</span> <span class="n">Education</span>

<span class="c1"># Which files that are not source code do you want to deploy?</span>
<span class="p">[</span><span class="n">files</span><span class="p">]</span>
<span class="n">data_files</span> <span class="o">=</span>
    <span class="n">some</span><span class="o">/</span><span class="n">example</span> <span class="o">=</span> <span class="n">some</span><span class="o">/</span><span class="n">example</span><span class="o">/*</span>

<span class="c1"># Where does your app start?</span>
<span class="p">[</span><span class="n">entry_points</span><span class="p">]</span>
<span class="n">console_scripts</span> <span class="o">=</span>
    <span class="n">automabot</span> <span class="o">=</span> <span class="n">your_package</span><span class="o">.</span><span class="n">__main__</span><span class="p">:</span><span class="n">main</span>
</pre></div>
</div>
<p>üéâ After a few tweaking you are now ready to go! üéâ</p>
</div>
</div>
<div class="section" id="step-2-enable-travis">
<h2><cite>‚úîÔ∏èStep 2: Enable Travis!</cite><a class="headerlink" href="#step-2-enable-travis" title="Permalink to this headline">¬∂</a></h2>
<p>Two ways of enabling Travis are presented here. One using <a class="reference external" href="https://github.com/travis-ci/travis.rb">Travis CLI</a> and one without.</p>
<div class="section" id="using-travis-cli">
<h3><cite>Using travis CLI</cite><a class="headerlink" href="#using-travis-cli" title="Permalink to this headline">¬∂</a></h3>
<p>Run <code class="code docutils literal notranslate"><span class="pre">travis</span> <span class="pre">login</span></code> and login to travis.</p>
<p>Now you can run <code class="code docutils literal notranslate"><span class="pre">travis</span> <span class="pre">init</span></code>.</p>
<p>If you are in a git repository, Travis will detect it and ask if this is correct.</p>
<p>Otherwise, it will tell you it can detect the repo.</p>
<p>Once you hit <code class="code docutils literal notranslate"><span class="pre">Enter</span></code>, Travis asks the main language. In this case, type <code class="code docutils literal notranslate"><span class="pre">Python</span></code>.</p>
<p>Now a new file called <code class="code docutils literal notranslate"><span class="pre">.travis.yml</span></code> has been created and is available in your repo. Moreover, Travis is now enabled for this repo.</p>
<p>We will go through this file later.</p>
</div>
<div class="section" id="manually">
<h3><cite>Manually</cite><a class="headerlink" href="#manually" title="Permalink to this headline">¬∂</a></h3>
<ul class="simple">
<li>Go to <a class="reference external" href="https://travis-ci.org">Travis home page</a>.</li>
<li>Sign up or Sign in.</li>
<li>Go to your profile page and sync your account.</li>
<li>Your public Github repositories are now listed above.</li>
<li>Toggle the project you want.</li>
</ul>
</div>
<div class="section" id="travis-yml">
<h3><cite>.travis.yml</cite><a class="headerlink" href="#travis-yml" title="Permalink to this headline">¬∂</a></h3>
<p>Now let‚Äôs write our setting file.</p>
<p>As the doc is really well made, I suggest you go check it first as I won‚Äôt explain everything. You can find it here <a class="reference external" href="https://docs.travis-ci.com/user/getting-started/">https://docs.travis-ci.com/user/getting-started/</a>.</p>
<p>However, I will explain the settings I usually use.</p>
<div class="code yaml highlight-default notranslate"><div class="highlight"><pre><span></span># Do I really need to explain this line?
language: python

# You can use a cache to build faster
cache: pip

# python version. You can define more than one if you want to run multiple tests
python:
  - &#39;3.6&#39;

# your install script or your install list
install: pip install rstcheck

# your test script or your install list
script: rstcheck --recursive .

# settings for notifications, I personnaly don&#39;t like to be spammed on my email
notifications:
  email:
    on_failure: never
    on_pull_requests: never

# the interresting part!
deploy:
  # If you need to deploy files Travis has built, use the next line
  skip_cleanup: true
  # In this case we want to deploy to pypi
  provider: pypi
  # What distribution we want to deploy
  distributions: sdist bdist_wheel
  # When do we want to deploy?
  on:
    # In this case I want to deploy only when a tag is present...
    tags: true
    # ... and when tag is on master and respects the form &quot;v0.0.0&quot;
    branch:
      - master
      - /v?(\d+\.)?(\d+\.)?(\*|\d+)$/
  # Your pypi username
  user: 73VW
  # Your Pypi password secured by Travis if you have Travis CLI installed
  password:
    secure: cGJz+vETnxwWAZQvzveJKOyn3rWy3/tcVmJvTVuflrgKgwMRm+sfQZB3vo39LzDcDbMzlzxLO4SUsqDpCxlPPM1pCjqHeUkke76pXA3HGTqfSS5VBic979pBDBqzFe8SLxery0ND7uPAam2xtZQcMRjIzMZFS+ZBD3tD9pWFnFqQOaw6Mwnfj2dWuA7BeNEBEeG+EErAJTqWHlwodjLsDBBilrvYEMPha049JWSz9TE1SMUKWZszCpo2hda8edvcB7WrNWJCYO+Pmc56aUHGlqiyRUowec9ZQplhmD7HWriRvda4n+1WqUB8tdACqBSBo6t39dis/yiLDv/qZpi6cooxJBtlK184AZvCIfjiu8ua5JqJ/SBghzrwLf7b5VbWg/WOtS8NEB+TYhZhpmkYLPXnOoJLYbbrOYA/sz/QfwXke2NCTp7apZFAtU1lFN2gVWsmff7ysRWwwHW/iidCAcu9BXlwMt2x2dv5PqSSqN1QdwCQ+cGcewlIPInHwCpXwI4sJXPEHeax0J5c206Yf4PMkzgrUj1+UmpB2AKJkMF0+kGd+MOj9SXYbNE1Lc456CuvKUflVry12mVQCgqqL6lZQadQ+aNKy0LoK4o4CN6JTUMpIn6JIOapLc9hzOGZgVuFzZ5YAs6l8VraMzZuAzOEv79UB92B3Iq2Vxki8vo=
  # Use the following if you don&#39;t have Travis CLI
  password : ${PYPI_PASSWORD}
</pre></div>
</div>
</div>
<div class="section" id="password">
<h3><cite>Password</cite><a class="headerlink" href="#password" title="Permalink to this headline">¬∂</a></h3>
<p>If you don‚Äôt have <a class="reference external" href="https://github.com/travis-ci/travis.rb">Travis CLI</a> installed, use the second option I mentioned above and do the following:</p>
<ul class="simple">
<li>In your profile page, find your project and click on the little gear ‚öôÔ∏è. This will bring you to the settings.</li>
<li>Go to the <code class="code docutils literal notranslate"><span class="pre">Environment</span> <span class="pre">Variables</span></code> section and add a new variable.</li>
<li>If you take my example, its name will be PYPI_PASSWORD and the value your password.</li>
</ul>
<a class="reference internal image-reference" href="../_images/Add_pypi_password.PNG"><img alt="How-to add your password to Travis" src="../_images/Add_pypi_password.PNG" style="width: 100%;" /></a>
<p>If you have <a class="reference external" href="https://github.com/travis-ci/travis.rb">Travis CLI</a>, this one is for you.</p>
<ul class="simple">
<li>Leave blank the password section, like the following.</li>
</ul>
<div class="code yaml highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">user</span><span class="p">:</span> <span class="mi">73</span><span class="n">VW</span>
<span class="c1"># Your Pypi password</span>
<span class="n">password</span><span class="p">:</span>
</pre></div>
</div>
<ul class="simple">
<li>Now let‚Äôs encrypt it! Simply run <code class="code docutils literal notranslate"><span class="pre">travis</span> <span class="pre">encrypt</span> <span class="pre">--add</span> <span class="pre">deploy.password</span></code> and Travis will ask for your password, encrypt it and paste it to the file.</li>
</ul>
<p>üéâ Now your are ready to go! üéâ</p>
</div>
</div>
<div class="section" id="so-what-now">
<h2><cite>‚úîÔ∏èSo what now?!</cite><a class="headerlink" href="#so-what-now" title="Permalink to this headline">¬∂</a></h2>
<p>Well, let‚Äôs try to push everyhing to the repository to check if everything is alright and if the tests pass!</p>
<p>Go to <a class="reference external" href="https://travis-ci.org">Travis home page</a> and check if everything went well!</p>
<p>As you remember, we haven‚Äôt set up any tag in github so this commit shouldn‚Äôt get deployed.</p>
<p>Travis will also tell it:</p>
<p><code class="code docutils literal notranslate"><span class="pre">Skipping</span> <span class="pre">a</span> <span class="pre">deployment</span> <span class="pre">with</span> <span class="pre">the</span> <span class="pre">pypi</span> <span class="pre">provider</span> <span class="pre">because</span> <span class="pre">this</span> <span class="pre">is</span> <span class="pre">not</span> <span class="pre">a</span> <span class="pre">tagged</span> <span class="pre">commit</span></code></p>
</div>
<div class="section" id="let-s-tag-it">
<h2><cite>‚úîÔ∏èLet‚Äôs tag it!</cite><a class="headerlink" href="#let-s-tag-it" title="Permalink to this headline">¬∂</a></h2>
<p>Now, create a tag. This is easy with git. Git tag doc can be found <a class="reference external" href="https://git-scm.com/book/en/v2/Git-Basics-Tagging">here</a>.</p>
<p>Note that with <code class="code docutils literal notranslate"><span class="pre">git</span> <span class="pre">tag</span></code> the option <code class="code docutils literal notranslate"><span class="pre">-a</span></code> allows you to specify the version and <code class="code docutils literal notranslate"><span class="pre">-m</span></code> the message.</p>
<p>So your command will be the following:</p>
<p><code class="code docutils literal notranslate"><span class="pre">git</span> <span class="pre">tag</span> <span class="pre">-a</span> <span class="pre">0.0.1</span> <span class="pre">-m</span> <span class="pre">&quot;First</span> <span class="pre">pypi</span> <span class="pre">deployment&quot;</span></code></p>
<p>Now you can check if it was created by running <code class="code docutils literal notranslate"><span class="pre">git</span> <span class="pre">tag</span></code>.
The result should look like the following.</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span>$ git tag
v0.0.1
</pre></div>
</div>
<p>And now push and check again Travis and pypi and your package should be deployed!</p>
<p>PSA: Don‚Äôt forget to add <code class="code docutils literal notranslate"><span class="pre">--tags</span></code> to your push command otherwise they will stay in your local repo.</p>
<p><strong>‚úîÔ∏èDeployed!</strong></p>
</div>
<div class="section" id="global-notes">
<h2><cite>‚ö†Ô∏èGlobal notes</cite><a class="headerlink" href="#global-notes" title="Permalink to this headline">¬∂</a></h2>
<p>‚úîÔ∏è Your project must be public in order to use Travis. Otherwise you have to upgrade to Travis pro.</p>
<p>‚úîÔ∏è Your email address must be verified on pypi in order to upload a new project. Otherwise upload will be rejected.</p>
<p>‚úîÔ∏èYour tag version <strong>MUST</strong> be in the form [DIGIT.DIGIT.DIGIT]. Check <a class="reference external" href="https://docs.openstack.org/pbr/3.1.0/semver.html">https://docs.openstack.org/pbr/3.1.0/semver.html</a> for more infos.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table des Mati√®res</a></h3>
  <ul>
<li><a class="reference internal" href="#"><cite>‚öôÔ∏èAutomate your publishing to PyPI with PBR and Travis</cite></a><ul>
<li><a class="reference internal" href="#step-1-write-the-setup-for-your-python-project"><cite>‚úîÔ∏èStep 1: write the setup for your python project</cite></a><ul>
<li><a class="reference internal" href="#setup-py"><cite>Setup.py</cite></a></li>
<li><a class="reference internal" href="#setup-cfg"><cite>Setup.cfg</cite></a></li>
</ul>
</li>
<li><a class="reference internal" href="#step-2-enable-travis"><cite>‚úîÔ∏èStep 2: Enable Travis!</cite></a><ul>
<li><a class="reference internal" href="#using-travis-cli"><cite>Using travis CLI</cite></a></li>
<li><a class="reference internal" href="#manually"><cite>Manually</cite></a></li>
<li><a class="reference internal" href="#travis-yml"><cite>.travis.yml</cite></a></li>
<li><a class="reference internal" href="#password"><cite>Password</cite></a></li>
</ul>
</li>
<li><a class="reference internal" href="#so-what-now"><cite>‚úîÔ∏èSo what now?!</cite></a></li>
<li><a class="reference internal" href="#let-s-tag-it"><cite>‚úîÔ∏èLet‚Äôs tag it!</cite></a></li>
<li><a class="reference internal" href="#global-notes"><cite>‚ö†Ô∏èGlobal notes</cite></a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="../watchdog/index.html" title="Chapitre pr√©c√©dent"><code class="docutils literal notranslate"><span class="pre">watchdog</span></code></a></li>
      <li>Next: <a href="../misc/about.html" title="Chapitre suivant">√Ä propos de ce livre</a></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>Cette page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/pbr/index.rst.txt"
            rel="nofollow">Montrer le code source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Recherche rapide</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016-2017, HE-Arc.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.7.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
      |
      <a href="../_sources/pbr/index.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>